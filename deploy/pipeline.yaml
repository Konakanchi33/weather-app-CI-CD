steps:
  # Build the Docker image
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'gcr.io/$PROJECT_ID/flask-weather-app', '.']

  # Push the Docker image to Google Container Registry
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'gcr.io/$PROJECT_ID/flask-weather-app']

  # Deploy to the development environment
  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: 'gcloud'
    args: ['builds', 'submit', '--config', 'dev.yaml']

  # Approval step before production deployment
  - name: 'gcr.io/cloud-builders/gcloud'
    args: ['beta', 'builds', 'approvals', 'wait-for-approval']

  # Deploy to the production environment
  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: 'gcloud'
    args: ['builds', 'submit', '--config', 'prod.yaml']

substitutions:
  _REGION: 'us-central1'
